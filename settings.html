<div class="fantastical-settings">
  <h3>Fantastical Name Generator</h3>
  <label class="st-flex st-gap-1 st-ai-center">
    <input type="checkbox" id="fn_enable" />
    <span>Enable Function Tool</span>
  </label>

  <script>
    (function(){
      function getCtx(){
        try { if (typeof SillyTavern !== 'undefined' && typeof SillyTavern.getContext === 'function') return SillyTavern.getContext(); } catch(_){}
        try { if (typeof getContext === 'function') return getContext(); } catch(_){}
        return {};
      }
      const key = 'fantastical_namegen';
      function get(){ const ctx = getCtx(); return (ctx.extensionSettings?.[key]) || {}; }
      function set(values){ const ctx = getCtx(); if(!ctx.extensionSettings) ctx.extensionSettings = {}; ctx.extensionSettings[key] = { ...(get()), ...values }; ctx.saveSettingsDebounced?.(); }

      function refresh(){
        const s = Object.assign({ enableFunctionTool: true }, get());
        document.getElementById('fn_enable').checked = !!s.enableFunctionTool;
      }

      document.getElementById('fn_enable').addEventListener('change', (e) => {
        set({ enableFunctionTool: !!e.target.checked });
        globalThis.FantasticalNameGen?.reRegister?.();
        getCtx().toast?.('Fantastical settings saved');
      });

      refresh();
    })();
  </script>
</div>
